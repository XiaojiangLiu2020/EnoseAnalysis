# 电子鼻数据分析与气味识别平台

这是一个基于 Web 的交互式应用，旨在帮助研究人员和工程师分析来自电子鼻（E-nose）的传感器阵列数据。用户可以上传原始数据，进行基线校准，交互式地标记样本，并通过主成分分析（PCA）和支持向量机（SVM）进行可视化和初步分类。

本平台使用 Python 的 Dash 框架构建，具有直观的用户界面和强大的后端数据处理能力。

![应用界面截图]
*(注：这是一个示例截图，实际界面以应用为准)*

## 目录

- [主要功能](#主要功能)
- [技术栈](#技术栈)
- [安装与运行](#安装与运行)
- [使用指南](#使用指南)
  - [第一步：文件管理](#第一步文件管理)
  - [第二步：基线校准（可选但推荐）](#第二步基线校准可选但推荐)
  - [第三步：数据标记](#第三步数据标记)
  - [第四步：降维与分类](#第四步降维与分类)
  - [第五步：数据导出](#第五步数据导出)
- [核心算法详解](#核心算法详解)
  - [主成分分析 (PCA) 的降维逻辑](#主成分分析-pca-的降维逻辑)
  - [支持向量机 (SVM) 的参数详解](#支持向量机-svm-的参数详解)
- [输入文件格式建议](#输入文件格式建议)
- [许可](#许可)

## 主要功能

*   **文件管理**：支持拖放或点击上传多个 `.csv`, `.xls`, `.xlsx` 格式的传感器数据文件。
*   **数据可视化**：实时绘制传感器响应的时间序列图，方便观察数据趋势。
*   **高级基线校准**：
    *   **固定范围平均法**：使用指定数据范围的平均值作为静态基线。
    *   **多点线性拟合漂移校准法**：通过在图上交互式选点，拟合动态基线以校正传感器漂移。
    *   支持多种校准算法 (`R / R0`, `R - R0`, `1 - R/R0`)。
    *   可随时重置为原始数据。
*   **交互式数据标记**：通过在时间序列图上点击选择数据点，并为它们赋予类别标签（如“样品A”、“样品B”）。
*   **降维分析**：使用主成分分析（PCA）将高维传感器数据降至 2D 或 3D，实现样本聚类可视化。
*   **模式识别**：在 PCA 结果上训练支持向量机（SVM）模型，并可视化决策边界，用于初步评估样本的可区分性。
*   **数据导出**：可一键下载 PCA 降维后的数据及对应标签，方便后续在其他软件中进行深入分析。

## 技术栈

*   后端与前端：**Dash (Python)**
*   数据处理：**Pandas**, **Numpy**
*   机器学习：**Scikit-learn**
*   图表绘制：**Plotly**

## 安装与运行

请确保您的环境中已安装 Python (建议 3.7+)。

**1. 克隆或下载代码库**

```bash
git clone https://github.com/your-username/your-repository-name.git
cd your-repository-name
```

**2. 创建虚拟环境（推荐）**

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS / Linux
python3 -m venv venv
source venv/bin/activate
```

**3. 安装依赖**

项目所需的库已在代码中列出。您可以创建一个 `requirements.txt` 文件，内容如下：

```txt
dash
pandas
plotly
scikit-learn
openpyxl # 用于支持 Excel 文件
```

然后通过 pip 安装：

```bash
pip install -r requirements.txt
```

**4. 运行应用**

执行主 Python 脚本：

```bash
python your_script_name.py
```

脚本启动后，它会自动在您的默认浏览器中打开一个网页（地址通常是 `http://127.0.0.1:8050`）。现在您可以开始使用该平台了。

## 使用指南

应用界面分为左右两部分：左侧是**控制面板**，右侧是**图表显示区域**。

### 第一步：文件管理

1.  在左侧面板的 **“操作与校准”** 标签页下，找到 **“1. 文件管理”** 卡片。
2.  点击或将您的数据文件（CSV/Excel）拖拽到上传区域。您可以一次上传多个文件。
3.  上传成功后，文件名会显示在下方列表中。
4.  在 **“选择活动文件进行分析”** 下拉菜单中，选择您希望处理的文件。右侧的时间序列图将自动更新。

### 第二步：基线校准（可选但推荐）

基线校准是消除传感器漂移、提高信噪比的关键步骤。

1.  在 **“2. 基线校准”** 卡片中，首先选择一个**校准算法**：
    *   **比值法 (R / R0)**：最常用，用响应值除以基线值。
    *   **差值法 (R - R0)**：用响应值减去基线值。
    *   **反比值法 (1 - R/R0)**：比值法的变种。

2.  根据您的数据特性，选择一种校准方式：

    *   **方式一：固定范围平均（适用于稳定基线）**
        *   在 `Start` 和 `End` 输入框中填入代表基线的数据点索引范围（例如，气体注入前的稳定阶段）。
        *   点击 **“应用固定”** 按钮。时间序列图会自动更新为校准后的数据。

    *   **方式二：多点线性拟合（适用于基线漂移）**
        *   点击 **“1. 点击选择基线点”** 按钮，此时应用进入“选点模式”。
        *   在右侧的时间序列图上，沿着您认为是基线漂移的路径点击多个点（至少2个）。这些点会以紫色虚线标记。
        *   选点完成后，点击 **“2. 拟合并应用”** 按钮。程序将对这些点进行线性拟合，生成一条动态基线，并据此校准整个数据集。
        *   如果选点不满意，可以点击 **“清除点”** 来重新选择。

3.  若要撤销校准，点击 **“重置为原始数据”** 即可。

### 第三步：数据标记

为了进行分类和模式识别，您需要为数据点（通常是响应峰值）赋予标签。

1.  切换到 **“数据标记”** 标签页。
2.  点击 **“开始标记”** 按钮，进入“标记模式”。
3.  在右侧的时间序列图上，点击一个或多个您希望归为同一类别的点。选中的点会以蓝色虚线标记。
4.  在下方的 **“输入标签名称”** 输入框中为这些点命名（例如：“咖啡”、“茶叶”）。
5.  点击 **“保存标签”**。标签信息会出现在下方的“已标记数据列表”中，并且图上的临时标记线会变为带有标签名称的红色虚线。
6.  重复步骤 3-5，直到所有样本都标记完毕。
7.  若要清除所有已保存的标签，可点击 **“清除所有标签”**。

### 第四步：降维与分类

当您标记了足够的数据点后（至少2个），就可以进行 PCA 和 SVM 分析。

1.  切换到 **“降维与分类”** 标签页。

2.  **PCA 降维分析**:
    *   选择一种**数据预处理方法**：标准化（常用）或归一化。
    *   选择希望降到的**维度**（2D 或 3D）。
    *   点击 **“生成/更新 PCA 图”**。右下方的图表将显示 PCA 降维后的散点图，不同颜色的点代表您标记的不同类别。

3.  **SVM 决策边界** (需要至少两个不同标签):
    *   在 PCA 图生成后，您可以配置 SVM 参数：
        *   **核函数 (Kernel)**：根据数据分布选择 `linear`, `rbf`, 或 `poly`。
        *   **正则化参数 (C)**：控制模型的复杂度。
        *   **Gamma / Degree**: 仅在特定核函数下可用。
    *   点击 **“生成/更新 SVM 边界”**。在 2D PCA 图上，将叠加显示 SVM 计算出的分类决策边界。
    *   **注意**：在 3D 模式下，仅当使用 `linear` 核函数且只有两个标签时，才会显示分类平面。

### 第五步：数据导出

1.  在 **“降维与分类”** 标签页中，当 PCA 图生成后，**“下载PCA数据”** 按钮会变为可用状态。
2.  点击该按钮，浏览器将下载一个名为 `pca_results.csv` 的文件。该文件包含了每个标记点的原始索引、标签、来源文件以及降维后的主成分坐标。

## 核心算法详解

### 主成分分析 (PCA) 的降维逻辑

**1. 目标是什么？**

电子鼻通常有多个传感器（例如8个、16个），这意味着每个数据点都存在于一个高维空间中（8维、16维）。我们无法直接可视化这个空间。此外，不同传感器之间可能存在高度相关性，意味着信息有冗余。

PCA 的核心目标是：**在尽可能保留原始数据信息的前提下，降低数据的维度。** 它通过寻找一个新的坐标系来重新描述数据，使得数据在新坐标系下的方差（信息量）最大化。

**2. 如何实现？**

可以把 PCA 想象成给一团三维空间中的点云（数据）找一个最佳的“视角”来拍一张二维照片。

*   **第一主成分 (PC1)**：PCA 首先会寻找一个方向（一个坐标轴），当所有数据点都投影到这个方向上时，它们的分布最为分散（即方差最大）。这个方向就捕获了数据中最主要的变化信息，被称为“第一主成分”。在图表的坐标轴上，您会看到 `PC1 (xx.x%)`，这个百分比代表了 PC1 解释了原始数据总方差的多少。

*   **第二主成分 (PC2)**：接下来，PCA 会在与 PC1 **正交（垂直）** 的所有方向中，寻找另一个能使投影方差次大的方向。这个方向就是“第二主成分”。它捕获了剩余信息中最重要的部分。

*   **后续主成分**：以此类推，PC3 会与 PC1 和 PC2 都正交，并捕获下一个最大的方差。

**3. 最终结果**

通过这个过程，PCA 将原始的多个传感器维度（如 `Sensor1`, `Sensor2`, ...）转换为了少数几个新的、互不相关的维度（`PC1`, `PC2`, `PC3`, ...）。

*   当您选择 **2D** 降维时，平台使用 PC1 和 PC2 作为新的坐标轴来绘制散点图。
*   当您选择 **3D** 降维时，则使用 PC1, PC2 和 PC3。

如果降维后，不同标签的样本在图上形成了清晰的聚类，这表明电子鼻数据能够有效地区分这些样本。

### 支持向量机 (SVM) 的参数详解

SVM 的目标是找到一个“最佳”的边界（超平面）来将不同类别的数据点分开。所谓“最佳”，是指这个边界到最近的数据点（即“支持向量”）的距离（“间隔”，Margin）最大。一个更大的间隔通常意味着模型有更好的泛化能力。

以下是本平台中可调整的 SVM 参数及其作用：

**1. `kernel` (核函数)**

核函数是 SVM 的精髓，它决定了决策边界的形状。

*   **`linear` (线性核)**：
    *   **作用**：尝试用一条直线（2D）或一个平面（3D）来分割数据。
    *   **适用场景**：当数据本身就是线性可分的，或者您希望得到一个简单、解释性强的模型时。它计算速度最快。

*   **`rbf` (径向基核)**：
    *   **作用**：能够创建复杂的、非线性的曲线边界。它是最常用、最强大的核函数之一。
    *   **适用场景**：当数据分布复杂、线性不可分时。这是默认的推荐选项。它的行为受 `C` 和 `gamma` 参数共同影响。

*   **`poly` (多项式核)**：
    *   **作用**：创建多项式曲线边界。
    *   **适用场景**：适用于数据呈现多项式规律的场景。它的行为受 `C`, `gamma` 和 `degree` 参数影响。

**2. `C` (正则化参数)**

参数 `C` 用于权衡 **“间隔最大化”** 和 **“避免误分类”** 这两个目标。

*   **较小的 `C`**：
    *   **效果**：允许模型“容忍”一些错误分类点，以换取一个更宽、更平滑的决策边界（软间隔）。
    *   **优点**：泛化能力可能更强，能有效避免对噪声数据过拟合。
    *   **缺点**：可能会牺牲一些训练集上的准确率。

*   **较大的 `C`**：
    *   **效果**：对错误分类的惩罚很高，迫使模型尽可能地将所有点都正确分类，即使这意味着决策边界会变得非常曲折、间隔很窄（硬间隔）。
    *   **优点**：在训练集上能达到很高的准确率。
    *   **缺点**：容易过拟合，模型对噪声敏感，在新数据上表现可能不佳。

**3. `gamma` (Gamma)**

此参数仅在 `rbf` 和 `poly` 核函数中有效，它定义了单个训练样本的影响范围。

*   **较小的 `gamma`**：
    *   **效果**：影响范围大，决策边界会非常平滑、宽泛。
    *   **类比**：像一个视力模糊的人，只能看到数据的大致轮廓。
    *   **风险**：可能导致模型过于简单，无法捕捉数据的复杂结构（欠拟合）。

*   **较大的 `gamma`**：
    *   **效果**：影响范围小，决策边界会非常曲折，紧紧围绕着支持向量。
    *   **类比**：像一个拿着放大镜的人，过分关注局部细节。
    *   **风险**：极易导致模型过拟合，因为它学习到了训练数据的噪声。

**4. `degree` (多项式次数)**

此参数仅在 `poly` 核函数中有效。

*   **作用**：指定了多项式核函数的次数。例如，`degree=2` 意味着决策边界是二次曲线，`degree=3` 是三次曲线。
*   **效果**：次数越高，决策边界就越灵活、越复杂，但同时也越容易过拟合。

## 输入文件格式建议

为了获得最佳兼容性，请确保您的数据文件格式如下：

*   文件类型为 CSV 或 Excel。
*   第一行应为列标题（例如，传感器名称 `S1`, `S2`, `S3`...）。
*   每一行代表一个时间点的数据。
*   数据应为纯数值格式。程序会自动处理所有数值列。

**示例 `data.csv`:**

```csv
Timestamp,Sensor1,Sensor2,Sensor3,Sensor4
1,120.5,230.1,88.2,450.7
2,121.2,232.5,89.1,451.3
3,120.8,231.7,88.5,450.9
...
```

## 许可

本项目采用 [MIT License](LICENSE) 授权。# EnoseAnalysis
